# Maintainer: Gilrain <gilrain+libre.arch A_T castelmo DOT_ re>

_pkgname='pology'
pkgname='pology-git'
pkgver='0.13.r5681.4ed65229'
pkgrel='1'
pkgdesc='A framework for custom processing of PO files.'
arch=('any')
license=('GPL3')
url="https://invent.kde.org/sdk/${_pkgname}"
depends=('python' 'gettext')
makedepends=('cmake' 'docbook-xsl' 'git' 'libxml2' 'libxslt' 'python-setuptools' 'python-pygments')
checkdepends=('python-pytest')
optdepends=(
    'python-dbus: to communicate with external applications'
	'python-pyenchant: for spell checking functionality'
	'languagetool: used by the check-grammar sieve'
	'apertium: used by the pomtrans script'
	'git: for processing files under version control'
	'subversion: for processing files under version control')
provides=('pology')
source=("git+${url}.git")
sha512sums=('SKIP')

pkgver() {
  cd "${_pkgname}"
  printf "%s.r%s.%s" "$(cat VERSION)" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

build() {
    cmake -B build -S "${_pkgname}" -DCMAKE_INSTALL_PREFIX='/usr'
}

check() {
  cd "${_pkgname}"
  python -m pytest
}

package() {
  DESTDIR="${pkgdir}" cmake --install build
  install -d "${pkgdir}/usr/share/apps/katepart/syntax"
  ln -s "${pkgdir}/usr/share/pology/syntax/kate/synder.xml" "${pkgdir}/usr/share/apps/katepart/syntax/synder.xml"
  install -d "${pkgdir}/usr/share/bash-completion/completions"
  ln -s "${pkgdir}/usr/share/pology/completion/bash/pology" "${pkgdir}/usr/share/bash-completion/completions/pology"
}
